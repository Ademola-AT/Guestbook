<!DOCTYPE html>
<html lang="en-us">
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="generator" content="Hugo 0.91.2" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>Subscribe to Messages from a Topic &middot; Go CDK</title>

  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Source+Code+Pro|Work+Sans:400,700">
  <link type="text/css" rel="stylesheet" href="/css/syntax.css">
  <link type="text/css" rel="stylesheet" href="/css/style.css">
  <link rel="shortcut icon" href="/favicon-32x32.png">
  
</head>
<body>
  <div class="PageLayout">
    <header class="PageHeader">
      <a href="https://gocloud.dev/"><h1 class="PageLogo"><img class="PageLogo-image" src="/go-cdk-logo-white.png" alt="Go CDK"></h1></a>
    </header>
    <main class="MainContent">
      <div class="MainContent-bounds"><h1>Subscribe to Messages from a Topic</h1>

<nav class="PageTOC">
  <div class="PageTOC-heading">In this article</div>
  <nav id="TableOfContents">
  <ul>
    <li><a href="#opening">Opening a Subscription</a></li>
    <li><a href="#receiving">Receiving and Acknowledging Messages</a></li>
    <li><a href="#other-usage-samples">Other Usage Samples</a></li>
    <li><a href="#services">Supported Pub/Sub Services</a>
      <ul>
        <li><a href="#gcp">Google Cloud Pub/Sub</a></li>
        <li><a href="#sqs">Amazon Simple Queueing Service</a></li>
        <li><a href="#azure">Azure Service Bus</a></li>
        <li><a href="#rabbitmq">RabbitMQ</a></li>
        <li><a href="#nats">NATS</a></li>
        <li><a href="#kafka">Kafka</a></li>
        <li><a href="#mem">In-Memory</a></li>
      </ul>
    </li>
  </ul>
</nav>
</nav>

<p>Subscribing to receive message from a topic with the Go CDK takes three steps:</p>
<ol>
<li><a href="#opening">Open a subscription</a> to a topic with the Pub/Sub service of your choice (once per
subscription).</li>
<li><a href="#receiving">Receive and acknowledge messages</a> from the topic. After completing any
work related to the message, use the Ack method to prevent it from being
redelivered.</li>
</ol>
<h2 id="opening"> Opening a Subscription<a class="anchor" href="#opening" aria-label="Link to Section">ðŸ”—</a></h2>
<p>The first step in subscribing to receive messages from a topic is
to instantiate a portable <a href="https://godoc.org/gocloud.dev/pubsub#Subscription"><code>*pubsub.Subscription</code></a> for your service.</p>
<p>The easiest way to do so is to use <a href="https://godoc.org/gocloud.dev/pubsub#OpenTopic"><code>pubsub.OpenSubscription</code></a>
and a service-specific URL pointing to the topic, making sure you
<a href="https://golang.org/doc/effective_go.html#blank_import">&ldquo;blank import&rdquo;</a> the driver package to link it in.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kn">import</span> <span class="p">(</span>
    <span class="s">&#34;context&#34;</span>

    <span class="s">&#34;gocloud.dev/pubsub&#34;</span>
    <span class="nx">_</span> <span class="s">&#34;gocloud.dev/pubsub/&lt;driver&gt;&#34;</span>
<span class="p">)</span>
<span class="o">...</span>
<span class="nx">ctx</span> <span class="o">:=</span> <span class="nx">context</span><span class="p">.</span><span class="nf">Background</span><span class="p">()</span>
<span class="nx">subs</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">pubsub</span><span class="p">.</span><span class="nf">OpenSubscription</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span> <span class="s">&#34;&lt;driver-url&gt;&#34;</span><span class="p">)</span>
<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">fmt</span><span class="p">.</span><span class="nf">Errorf</span><span class="p">(</span><span class="s">&#34;could not open topic subscription: %v&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
<span class="p">}</span>
<span class="k">defer</span> <span class="nx">subs</span><span class="p">.</span><span class="nf">Shutdown</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span>
<span class="c1">// subs is a *pubsub.Subscription; see usage below
</span><span class="c1"></span><span class="o">...</span>
</code></pre></div><p>See <a href="https://gocloud.dev/concepts/urls/">Concepts: URLs</a> for general background and the <a href="#services">guide below</a>
for URL usage for each supported service.</p>
<p>Alternatively, if you need fine-grained
control over the connection settings, you can call the constructor function in
the driver package directly (like <code>gcppubsub.OpenSubscription</code>).</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kn">import</span> <span class="s">&#34;gocloud.dev/pubsub/&lt;driver&gt;&#34;</span>
<span class="o">...</span>
<span class="nx">subs</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="p">&lt;</span><span class="nx">driver</span><span class="p">&gt;.</span><span class="nf">OpenSubscription</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="o">...</span>
</code></pre></div><p>You may find the <a href="http://github.com/google/wire"><code>wire</code> package</a> useful for managing your initialization code
when switching between different backing services.</p>
<p>See the <a href="#services">guide below</a> for constructor usage for each supported service.</p>
<h2 id="receiving"> Receiving and Acknowledging Messages<a class="anchor" href="#receiving" aria-label="Link to Section">ðŸ”—</a></h2>
<p>A simple subscriber that operates on
<a href="https://godoc.org/gocloud.dev/pubsub#Message">messages</a> serially looks like
this:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="c1">// Loop on received messages.
</span><span class="c1"></span><span class="k">for</span> <span class="p">{</span>
	<span class="nx">msg</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">subscription</span><span class="p">.</span><span class="nf">Receive</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span>
	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="c1">// Errors from Receive indicate that Receive will no longer succeed.
</span><span class="c1"></span>		<span class="nx">log</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;Receiving message: %v&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
		<span class="k">break</span>
	<span class="p">}</span>
	<span class="c1">// Do work based on the message, for example:
</span><span class="c1"></span>	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;Got message: %q\n&#34;</span><span class="p">,</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">Body</span><span class="p">)</span>
	<span class="c1">// Messages must always be acknowledged with Ack.
</span><span class="c1"></span>	<span class="nx">msg</span><span class="p">.</span><span class="nf">Ack</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div>
<p>If you want your subscriber to operate on incoming messages concurrently,
you can start multiple goroutines:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="c1">// Loop on received messages. We can use a channel as a semaphore to limit how
</span><span class="c1">// many goroutines we have active at a time as well as wait on the goroutines
</span><span class="c1">// to finish before exiting.
</span><span class="c1"></span><span class="kd">const</span> <span class="nx">maxHandlers</span> <span class="p">=</span> <span class="mi">10</span>
<span class="nx">sem</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="kd">struct</span><span class="p">{},</span> <span class="nx">maxHandlers</span><span class="p">)</span>
<span class="nx">recvLoop</span><span class="p">:</span>
<span class="k">for</span> <span class="p">{</span>
	<span class="nx">msg</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">subscription</span><span class="p">.</span><span class="nf">Receive</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span>
	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="c1">// Errors from Receive indicate that Receive will no longer succeed.
</span><span class="c1"></span>		<span class="nx">log</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;Receiving message: %v&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
		<span class="k">break</span>
	<span class="p">}</span>

	<span class="c1">// Wait if there are too many active handle goroutines and acquire the
</span><span class="c1"></span>	<span class="c1">// semaphore. If the context is canceled, stop waiting and start shutting
</span><span class="c1"></span>	<span class="c1">// down.
</span><span class="c1"></span>	<span class="k">select</span> <span class="p">{</span>
	<span class="k">case</span> <span class="nx">sem</span> <span class="o">&lt;-</span> <span class="kd">struct</span><span class="p">{}{}:</span>
	<span class="k">case</span> <span class="o">&lt;-</span><span class="nx">ctx</span><span class="p">.</span><span class="nf">Done</span><span class="p">():</span>
		<span class="k">break</span> <span class="nx">recvLoop</span>
	<span class="p">}</span>

	<span class="c1">// Handle the message in a new goroutine.
</span><span class="c1"></span>	<span class="k">go</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
		<span class="k">defer</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span> <span class="o">&lt;-</span><span class="nx">sem</span> <span class="p">}()</span> <span class="c1">// Release the semaphore.
</span><span class="c1"></span>		<span class="k">defer</span> <span class="nx">msg</span><span class="p">.</span><span class="nf">Ack</span><span class="p">()</span>          <span class="c1">// Messages must always be acknowledged with Ack.
</span><span class="c1"></span>
		<span class="c1">// Do work based on the message, for example:
</span><span class="c1"></span>		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;Got message: %q\n&#34;</span><span class="p">,</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">Body</span><span class="p">)</span>
	<span class="p">}()</span>
<span class="p">}</span>

<span class="c1">// We&#39;re no longer receiving messages. Wait to finish handling any
</span><span class="c1">// unacknowledged messages by totally acquiring the semaphore.
</span><span class="c1"></span><span class="k">for</span> <span class="nx">n</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">n</span> <span class="p">&lt;</span> <span class="nx">maxHandlers</span><span class="p">;</span> <span class="nx">n</span><span class="o">++</span> <span class="p">{</span>
	<span class="nx">sem</span> <span class="o">&lt;-</span> <span class="kd">struct</span><span class="p">{}{}</span>
<span class="p">}</span>
</code></pre></div>
<p>Note that the <a href="https://godoc.org/gocloud.dev/pubsub#hdr-At_most_once_and_At_least_once_Delivery">semantics of message delivery</a> can vary by backing service.</p>
<h2 id="other-usage-samples"> Other Usage Samples<a class="anchor" href="#other-usage-samples" aria-label="Link to Section">ðŸ”—</a></h2>
<ul>
<li><a href="https://github.com/google/go-cloud/tree/master/samples/gocdk-pubsub">CLI Sample</a></li>
<li><a href="https://gocloud.dev/tutorials/order/">Order Processor sample</a></li>
<li><a href="https://godoc.org/gocloud.dev/pubsub#pkg-examples">pubsub package examples</a></li>
</ul>
<h2 id="services"> Supported Pub/Sub Services<a class="anchor" href="#services" aria-label="Link to Section">ðŸ”—</a></h2>
<h3 id="gcp"> Google Cloud Pub/Sub<a class="anchor" href="#gcp" aria-label="Link to Section">ðŸ”—</a></h3>
<p>The Go CDK can receive messages from a Google <a href="https://cloud.google.com/pubsub/docs/">Cloud Pub/Sub</a> subscription.
The URLs use the project ID and the subscription ID.</p>
<p><code>pubsub.OpenSubscription</code> will use Application Default Credentials; if you have
authenticated via <a href="https://cloud.google.com/sdk/gcloud/reference/auth/application-default/login"><code>gcloud auth application-default login</code></a>, it will use those credentials. See
<a href="https://cloud.google.com/docs/authentication/production">Application Default Credentials</a> to learn about authentication
alternatives, including using environment variables.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kn">import</span> <span class="p">(</span>
	<span class="s">&#34;context&#34;</span>

	<span class="s">&#34;gocloud.dev/pubsub&#34;</span>
	<span class="nx">_</span> <span class="s">&#34;gocloud.dev/pubsub/gcppubsub&#34;</span>
<span class="p">)</span>

<span class="nx">subscription</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">pubsub</span><span class="p">.</span><span class="nf">OpenSubscription</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span>
	<span class="s">&#34;gcppubsub://projects/my-project/subscriptions/my-subscription&#34;</span><span class="p">)</span>
<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
	<span class="k">return</span> <span class="nx">err</span>
<span class="p">}</span>
<span class="k">defer</span> <span class="nx">subscription</span><span class="p">.</span><span class="nf">Shutdown</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span>
</code></pre></div>
<h4 id="gcp-ctor"> Google Cloud Pub/Sub Constructor<a class="anchor" href="#gcp-ctor" aria-label="Link to Section">ðŸ”—</a></h4>
<p>The <a href="https://godoc.org/gocloud.dev/pubsub/gcppubsub#OpenSubscription"><code>gcppubsub.OpenSubscription</code></a> constructor opens a Cloud Pub/Sub
subscription. You must first obtain <a href="https://cloud.google.com/docs/authentication/production">GCP credentials</a> and then
create a gRPC connection to Cloud Pub/Sub. (This gRPC connection can be
reused among subscriptions.)</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kn">import</span> <span class="p">(</span>
	<span class="s">&#34;context&#34;</span>

	<span class="s">&#34;gocloud.dev/gcp&#34;</span>
	<span class="s">&#34;gocloud.dev/pubsub/gcppubsub&#34;</span>
<span class="p">)</span>

<span class="c1">// Your GCP credentials.
</span><span class="c1">// See https://cloud.google.com/docs/authentication/production
</span><span class="c1">// for more info on alternatives.
</span><span class="c1"></span><span class="nx">creds</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">gcp</span><span class="p">.</span><span class="nf">DefaultCredentials</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span>
<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
	<span class="k">return</span> <span class="nx">err</span>
<span class="p">}</span>

<span class="c1">// Open a gRPC connection to the GCP Pub/Sub API.
</span><span class="c1"></span><span class="nx">conn</span><span class="p">,</span> <span class="nx">cleanup</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">gcppubsub</span><span class="p">.</span><span class="nf">Dial</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span> <span class="nx">creds</span><span class="p">.</span><span class="nx">TokenSource</span><span class="p">)</span>
<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
	<span class="k">return</span> <span class="nx">err</span>
<span class="p">}</span>
<span class="k">defer</span> <span class="nf">cleanup</span><span class="p">()</span>

<span class="c1">// Construct a SubscriberClient using the connection.
</span><span class="c1"></span><span class="nx">subClient</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">gcppubsub</span><span class="p">.</span><span class="nf">SubscriberClient</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span> <span class="nx">conn</span><span class="p">)</span>
<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
	<span class="k">return</span> <span class="nx">err</span>
<span class="p">}</span>
<span class="k">defer</span> <span class="nx">subClient</span><span class="p">.</span><span class="nf">Close</span><span class="p">()</span>

<span class="c1">// Construct a *pubsub.Subscription.
</span><span class="c1"></span><span class="nx">subscription</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">gcppubsub</span><span class="p">.</span><span class="nf">OpenSubscriptionByPath</span><span class="p">(</span>
	<span class="nx">subClient</span><span class="p">,</span> <span class="s">&#34;projects/myprojectID/subscriptions/example-subscription&#34;</span><span class="p">,</span> <span class="kc">nil</span><span class="p">)</span>
<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
	<span class="k">return</span> <span class="nx">err</span>
<span class="p">}</span>
<span class="k">defer</span> <span class="nx">subscription</span><span class="p">.</span><span class="nf">Shutdown</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span>
</code></pre></div>
<h3 id="sqs"> Amazon Simple Queueing Service<a class="anchor" href="#sqs" aria-label="Link to Section">ðŸ”—</a></h3>
<p>The Go CDK can subscribe to an Amazon <a href="https://aws.amazon.com/sqs/">Simple Queueing Service</a> (SQS)
topic. SQS URLs closely resemble the the queue URL, except the leading
<code>https://</code> is replaced with <code>awssqs://</code>. You should specify the <code>region</code>
query parameter to ensure your application connects to the correct region.</p>
<p><code>pubsub.OpenSubscription</code> will create a default AWS Session with the
<code>SharedConfigEnable</code> option enabled; if you have authenticated with the AWS CLI,
it will use those credentials. See <a href="https://docs.aws.amazon.com/sdk-for-go/api/aws/session/">AWS Session</a> to learn about authentication
alternatives, including using environment variables.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kn">import</span> <span class="p">(</span>
	<span class="s">&#34;context&#34;</span>

	<span class="s">&#34;gocloud.dev/pubsub&#34;</span>
	<span class="nx">_</span> <span class="s">&#34;gocloud.dev/pubsub/awssnssqs&#34;</span>
<span class="p">)</span>

<span class="c1">// pubsub.OpenSubscription creates a *pubsub.Subscription from a URL.
</span><span class="c1">// This URL will open the subscription with the URL
</span><span class="c1">// &#34;https://sqs.us-east-2.amazonaws.com/123456789012/myqueue&#34;.
</span><span class="c1"></span><span class="nx">subscription</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">pubsub</span><span class="p">.</span><span class="nf">OpenSubscription</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span>
	<span class="s">&#34;awssqs://sqs.us-east-2.amazonaws.com/123456789012/&#34;</span><span class="o">+</span>
		<span class="s">&#34;myqueue?region=us-east-2&#34;</span><span class="p">)</span>
<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
	<span class="k">return</span> <span class="nx">err</span>
<span class="p">}</span>
<span class="k">defer</span> <span class="nx">subscription</span><span class="p">.</span><span class="nf">Shutdown</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span>
</code></pre></div>
<p>If your messages are being sent to SQS directly, or if they are being delivered
via an SNS topic with <code>RawMessageDelivery</code> enabled, set a <code>raw=true</code> query
parameter in your URL, or set <code>SubscriberOptions.Raw</code> to <code>true</code> if you&rsquo;re using
the constructors. By default, the subscription will use heuristics to identify
whether the message bodies are raw or <a href="https://aws.amazon.com/sns/faqs/#Raw_message_delivery">SNS JSON</a>.</p>
<p>Messages with a <code>base64encoded</code> message attribute will be automatically
<a href="https://en.wikipedia.org/wiki/Base64">Base64</a> decoded before being returned. See the <a href="https://gocloud.dev/howto/pubsub/publish/#sns">SNS publishing guide</a>
or the <a href="https://gocloud.dev/howto/pubsub/publish/#sqs">SQS publishing guide</a> for more details.</p>
<h4 id="sqs-ctor"> Amazon SQS Constructor<a class="anchor" href="#sqs-ctor" aria-label="Link to Section">ðŸ”—</a></h4>
<p>The <a href="https://godoc.org/gocloud.dev/pubsub/awssnssqs#OpenSubscription"><code>awssnssqs.OpenSubscription</code></a> constructor opens an SQS queue. You must
first create an <a href="https://docs.aws.amazon.com/sdk-for-go/api/aws/session/">AWS session</a> with the same region as your topic:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kn">import</span> <span class="p">(</span>
	<span class="s">&#34;context&#34;</span>

	<span class="s">&#34;github.com/aws/aws-sdk-go/aws&#34;</span>
	<span class="s">&#34;github.com/aws/aws-sdk-go/aws/session&#34;</span>
	<span class="s">&#34;gocloud.dev/pubsub/awssnssqs&#34;</span>
<span class="p">)</span>

<span class="c1">// Establish an AWS session.
</span><span class="c1">// See https://docs.aws.amazon.com/sdk-for-go/api/aws/session/ for more info.
</span><span class="c1">// The region must match the region for &#34;MyQueue&#34;.
</span><span class="c1"></span><span class="nx">sess</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">session</span><span class="p">.</span><span class="nf">NewSession</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">aws</span><span class="p">.</span><span class="nx">Config</span><span class="p">{</span>
	<span class="nx">Region</span><span class="p">:</span> <span class="nx">aws</span><span class="p">.</span><span class="nf">String</span><span class="p">(</span><span class="s">&#34;us-east-2&#34;</span><span class="p">),</span>
<span class="p">})</span>
<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
	<span class="k">return</span> <span class="nx">err</span>
<span class="p">}</span>

<span class="c1">// Construct a *pubsub.Subscription.
</span><span class="c1">// https://docs.aws.amazon.com/sdk-for-net/v2/developer-guide/QueueURL.html
</span><span class="c1"></span><span class="kd">const</span> <span class="nx">queueURL</span> <span class="p">=</span> <span class="s">&#34;https://sqs.us-east-2.amazonaws.com/123456789012/MyQueue&#34;</span>
<span class="nx">subscription</span> <span class="o">:=</span> <span class="nx">awssnssqs</span><span class="p">.</span><span class="nf">OpenSubscription</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span> <span class="nx">sess</span><span class="p">,</span> <span class="nx">queueURL</span><span class="p">,</span> <span class="kc">nil</span><span class="p">)</span>
<span class="k">defer</span> <span class="nx">subscription</span><span class="p">.</span><span class="nf">Shutdown</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span>
</code></pre></div>
<h3 id="azure"> Azure Service Bus<a class="anchor" href="#azure" aria-label="Link to Section">ðŸ”—</a></h3>
<p>The Go CDK can recieve messages from an <a href="https://azure.microsoft.com/en-us/services/service-bus/">Azure Service Bus</a> subscription.
The URL for subscribing is the topic name with the
subscription name in the <code>subscription</code> query parameter.
<code>pubsub.OpenSubscription</code> will use the environment variable
<code>SERVICEBUS_CONNECTION_STRING</code> to obtain the Service Bus Connection String
you need to copy <a href="https://docs.microsoft.com/en-us/azure/service-bus-messaging/service-bus-dotnet-how-to-use-topics-subscriptions#get-the-connection-string">from the Azure portal</a>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kn">import</span> <span class="p">(</span>
	<span class="s">&#34;context&#34;</span>

	<span class="s">&#34;gocloud.dev/pubsub&#34;</span>
	<span class="nx">_</span> <span class="s">&#34;gocloud.dev/pubsub/azuresb&#34;</span>
<span class="p">)</span>

<span class="c1">// pubsub.OpenSubscription creates a *pubsub.Subscription from a URL.
</span><span class="c1">// This URL will open the subscription &#34;mysubscription&#34; for the topic
</span><span class="c1">// &#34;mytopic&#34; using a connection string from the environment variable
</span><span class="c1">// SERVICEBUS_CONNECTION_STRING.
</span><span class="c1"></span><span class="nx">subscription</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">pubsub</span><span class="p">.</span><span class="nf">OpenSubscription</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span>
	<span class="s">&#34;azuresb://mytopic?subscription=mysubscription&#34;</span><span class="p">)</span>
<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
	<span class="k">return</span> <span class="nx">err</span>
<span class="p">}</span>
<span class="k">defer</span> <span class="nx">subscription</span><span class="p">.</span><span class="nf">Shutdown</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span>
</code></pre></div>
<h4 id="azure-ctor"> Azure Service Bus Constructor<a class="anchor" href="#azure-ctor" aria-label="Link to Section">ðŸ”—</a></h4>
<p>The <a href="https://godoc.org/gocloud.dev/pubsub/azuresb#OpenSubscription"><code>azuresb.OpenSubscription</code></a> constructor opens an Azure Service Bus
subscription. You must first connect to the topic and subscription using the
<a href="https://pkg.go.dev/github.com/Azure/azure-sdk-for-go/sdk/messaging/azservicebus">Azure Service Bus library</a> and then pass the subscription to
<code>azuresb.OpenSubscription</code>. There are also helper functions in the <code>azuresb</code>
package to make this easier.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kn">import</span> <span class="p">(</span>
	<span class="s">&#34;context&#34;</span>
	<span class="s">&#34;os&#34;</span>

	<span class="s">&#34;gocloud.dev/pubsub/azuresb&#34;</span>
<span class="p">)</span>

<span class="c1">// Change these as needed for your application.
</span><span class="c1"></span><span class="nx">serviceBusConnString</span> <span class="o">:=</span> <span class="nx">os</span><span class="p">.</span><span class="nf">Getenv</span><span class="p">(</span><span class="s">&#34;SERVICEBUS_CONNECTION_STRING&#34;</span><span class="p">)</span>
<span class="kd">const</span> <span class="nx">topicName</span> <span class="p">=</span> <span class="s">&#34;test-topic&#34;</span>
<span class="kd">const</span> <span class="nx">subscriptionName</span> <span class="p">=</span> <span class="s">&#34;test-subscription&#34;</span>

<span class="c1">// Connect to Azure Service Bus for the given subscription.
</span><span class="c1"></span><span class="nx">sbClient</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">azuresb</span><span class="p">.</span><span class="nf">NewClientFromConnectionString</span><span class="p">(</span><span class="nx">serviceBusConnString</span><span class="p">,</span> <span class="kc">nil</span><span class="p">)</span>
<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
	<span class="k">return</span> <span class="nx">err</span>
<span class="p">}</span>
<span class="nx">sbReceiver</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">azuresb</span><span class="p">.</span><span class="nf">NewReceiver</span><span class="p">(</span><span class="nx">sbClient</span><span class="p">,</span> <span class="nx">topicName</span><span class="p">,</span> <span class="nx">subscriptionName</span><span class="p">,</span> <span class="kc">nil</span><span class="p">)</span>
<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
	<span class="k">return</span> <span class="nx">err</span>
<span class="p">}</span>
<span class="k">defer</span> <span class="nx">sbReceiver</span><span class="p">.</span><span class="nf">Close</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span>

<span class="c1">// Construct a *pubsub.Subscription.
</span><span class="c1"></span><span class="nx">subscription</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">azuresb</span><span class="p">.</span><span class="nf">OpenSubscription</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span> <span class="nx">sbClient</span><span class="p">,</span> <span class="nx">sbReceiver</span><span class="p">,</span> <span class="kc">nil</span><span class="p">)</span>
<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
	<span class="k">return</span> <span class="nx">err</span>
<span class="p">}</span>
<span class="k">defer</span> <span class="nx">subscription</span><span class="p">.</span><span class="nf">Shutdown</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span>
</code></pre></div>
<h3 id="rabbitmq"> RabbitMQ<a class="anchor" href="#rabbitmq" aria-label="Link to Section">ðŸ”—</a></h3>
<p>The Go CDK can receive messages from an <a href="https://www.rabbitmq.com/protocol.html">AMQP 0.9.1</a> queue, the dialect of
AMQP spoken by <a href="https://www.rabbitmq.com">RabbitMQ</a>. A RabbitMQ URL only includes the queue name.
The RabbitMQ&rsquo;s server is discovered from the <code>RABBIT_SERVER_URL</code> environment
variable (which is something like <code>amqp://guest:guest@localhost:5672/</code>).</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kn">import</span> <span class="p">(</span>
	<span class="s">&#34;context&#34;</span>

	<span class="s">&#34;gocloud.dev/pubsub&#34;</span>
	<span class="nx">_</span> <span class="s">&#34;gocloud.dev/pubsub/rabbitpubsub&#34;</span>
<span class="p">)</span>

<span class="c1">// pubsub.OpenSubscription creates a *pubsub.Subscription from a URL.
</span><span class="c1">// This URL will Dial the RabbitMQ server at the URL in the environment
</span><span class="c1">// variable RABBIT_SERVER_URL and open the queue &#34;myqueue&#34;.
</span><span class="c1"></span><span class="nx">subscription</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">pubsub</span><span class="p">.</span><span class="nf">OpenSubscription</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span> <span class="s">&#34;rabbit://myqueue&#34;</span><span class="p">)</span>
<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
	<span class="k">return</span> <span class="nx">err</span>
<span class="p">}</span>
<span class="k">defer</span> <span class="nx">subscription</span><span class="p">.</span><span class="nf">Shutdown</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span>
</code></pre></div>
<h4 id="rabbitmq-ctor"> RabbitMQ Constructor<a class="anchor" href="#rabbitmq-ctor" aria-label="Link to Section">ðŸ”—</a></h4>
<p>The <a href="https://godoc.org/gocloud.dev/pubsub/rabbitpubsub#OpenSubscription"><code>rabbitpubsub.OpenSubscription</code></a> constructor opens a RabbitMQ queue.
You must first create an <a href="https://pkg.go.dev/github.com/rabbitmq/amqp091-go#Connection"><code>*amqp.Connection</code></a> to your RabbitMQ instance.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kn">import</span> <span class="p">(</span>
	<span class="s">&#34;context&#34;</span>

	<span class="nx">amqp</span> <span class="s">&#34;github.com/rabbitmq/amqp091-go&#34;</span>
	<span class="s">&#34;gocloud.dev/pubsub/rabbitpubsub&#34;</span>
<span class="p">)</span>

<span class="nx">rabbitConn</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">amqp</span><span class="p">.</span><span class="nf">Dial</span><span class="p">(</span><span class="s">&#34;amqp://guest:guest@localhost:5672/&#34;</span><span class="p">)</span>
<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
	<span class="k">return</span> <span class="nx">err</span>
<span class="p">}</span>
<span class="k">defer</span> <span class="nx">rabbitConn</span><span class="p">.</span><span class="nf">Close</span><span class="p">()</span>
<span class="nx">subscription</span> <span class="o">:=</span> <span class="nx">rabbitpubsub</span><span class="p">.</span><span class="nf">OpenSubscription</span><span class="p">(</span><span class="nx">rabbitConn</span><span class="p">,</span> <span class="s">&#34;myqueue&#34;</span><span class="p">,</span> <span class="kc">nil</span><span class="p">)</span>
<span class="k">defer</span> <span class="nx">subscription</span><span class="p">.</span><span class="nf">Shutdown</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span>
</code></pre></div>
<h3 id="nats"> NATS<a class="anchor" href="#nats" aria-label="Link to Section">ðŸ”—</a></h3>
<p>The Go CDK can publish to a <a href="https://nats.io/">NATS</a> subject. A NATS URL only includes the
subject name. The NATS server is discovered from the <code>NATS_SERVER_URL</code>
environment variable (which is something like <code>nats://nats.example.com</code>).</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kn">import</span> <span class="p">(</span>
	<span class="s">&#34;context&#34;</span>

	<span class="s">&#34;gocloud.dev/pubsub&#34;</span>
	<span class="nx">_</span> <span class="s">&#34;gocloud.dev/pubsub/natspubsub&#34;</span>
<span class="p">)</span>

<span class="c1">// pubsub.OpenSubscription creates a *pubsub.Subscription from a URL.
</span><span class="c1">// This URL will Dial the NATS server at the URL in the environment variable
</span><span class="c1">// NATS_SERVER_URL and receive messages with subject &#34;example.mysubject&#34;.
</span><span class="c1"></span><span class="nx">subscription</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">pubsub</span><span class="p">.</span><span class="nf">OpenSubscription</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span> <span class="s">&#34;nats://example.mysubject&#34;</span><span class="p">)</span>
<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
	<span class="k">return</span> <span class="nx">err</span>
<span class="p">}</span>
<span class="k">defer</span> <span class="nx">subscription</span><span class="p">.</span><span class="nf">Shutdown</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span>
</code></pre></div>
<p>NATS guarantees at-most-once delivery; it will never redeliver a message.
Therefore, <code>Message.Ack</code> is a no-op.</p>
<p>To parse messages <a href="https://gocloud.dev/howto/pubsub/publish/#nats">published via the Go CDK</a>, the NATS driver
will first attempt to decode the payload using <a href="https://golang.org/pkg/encoding/gob/">gob</a>. Failing that, it will
return the message payload as the <code>Data</code> with no metadata to accomodate
subscribing to messages coming from a source not using the Go CDK.</p>
<h4 id="nats-ctor"> NATS Constructor<a class="anchor" href="#nats-ctor" aria-label="Link to Section">ðŸ”—</a></h4>
<p>The <a href="https://godoc.org/gocloud.dev/pubsub/natspubsub#OpenSubscription"><code>natspubsub.OpenSubscription</code></a> constructor opens a NATS subject as a
topic. You must first create an <a href="https://godoc.org/github.com/nats-io/go-nats#Conn"><code>*nats.Conn</code></a> to your NATS instance.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kn">import</span> <span class="p">(</span>
	<span class="s">&#34;context&#34;</span>

	<span class="s">&#34;github.com/nats-io/nats.go&#34;</span>
	<span class="s">&#34;gocloud.dev/pubsub/natspubsub&#34;</span>
<span class="p">)</span>

<span class="nx">natsConn</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">nats</span><span class="p">.</span><span class="nf">Connect</span><span class="p">(</span><span class="s">&#34;nats://nats.example.com&#34;</span><span class="p">)</span>
<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
	<span class="k">return</span> <span class="nx">err</span>
<span class="p">}</span>
<span class="k">defer</span> <span class="nx">natsConn</span><span class="p">.</span><span class="nf">Close</span><span class="p">()</span>

<span class="nx">subscription</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">natspubsub</span><span class="p">.</span><span class="nf">OpenSubscription</span><span class="p">(</span>
	<span class="nx">natsConn</span><span class="p">,</span>
	<span class="s">&#34;example.mysubject&#34;</span><span class="p">,</span>
	<span class="kc">nil</span><span class="p">)</span>
<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
	<span class="k">return</span> <span class="nx">err</span>
<span class="p">}</span>
<span class="k">defer</span> <span class="nx">subscription</span><span class="p">.</span><span class="nf">Shutdown</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span>
</code></pre></div>
<h3 id="kafka"> Kafka<a class="anchor" href="#kafka" aria-label="Link to Section">ðŸ”—</a></h3>
<p>The Go CDK can receive messages from a <a href="https://kafka.apache.org/">Kafka</a> cluster.
A Kafka URL includes the consumer group name, plus at least one instance
of a query parameter specifying the topic to subscribe to.
The brokers in the Kafka cluster are discovered from the
<code>KAFKA_BROKERS</code> environment variable (which is a comma-delimited list of
hosts, something like <code>1.2.3.4:9092,5.6.7.8:9092</code>).</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kn">import</span> <span class="p">(</span>
	<span class="s">&#34;context&#34;</span>

	<span class="s">&#34;gocloud.dev/pubsub&#34;</span>
	<span class="nx">_</span> <span class="s">&#34;gocloud.dev/pubsub/kafkapubsub&#34;</span>
<span class="p">)</span>

<span class="c1">// pubsub.OpenSubscription creates a *pubsub.Subscription from a URL.
</span><span class="c1">// The host + path are used as the consumer group name.
</span><span class="c1">// The &#34;topic&#34; query parameter sets one or more topics to subscribe to.
</span><span class="c1">// The set of brokers must be in an environment variable KAFKA_BROKERS.
</span><span class="c1"></span><span class="nx">subscription</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">pubsub</span><span class="p">.</span><span class="nf">OpenSubscription</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span>
	<span class="s">&#34;kafka://my-group?topic=my-topic&#34;</span><span class="p">)</span>
<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
	<span class="k">return</span> <span class="nx">err</span>
<span class="p">}</span>
<span class="k">defer</span> <span class="nx">subscription</span><span class="p">.</span><span class="nf">Shutdown</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span>
</code></pre></div>
<h4 id="kafka-ctor"> Kafka Constructor<a class="anchor" href="#kafka-ctor" aria-label="Link to Section">ðŸ”—</a></h4>
<p>The <a href="https://godoc.org/gocloud.dev/pubsub/kafkapubsub#OpenSubscription"><code>kafkapubsub.OpenSubscription</code></a> constructor creates a consumer in a
consumer group, subscribed to one or more topics.</p>
<p>In addition to the list of brokers, you&rsquo;ll need a <a href="https://godoc.org/github.com/Shopify/sarama#Config"><code>*sarama.Config</code></a>, which
exposes many knobs that can affect performance and semantics; review and set
them carefully. <a href="https://godoc.org/gocloud.dev/pubsub/kafkapubsub#MinimalConfig"><code>kafkapubsub.MinimalConfig</code></a> provides a minimal config to
get you started.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kn">import</span> <span class="p">(</span>
	<span class="s">&#34;context&#34;</span>

	<span class="s">&#34;gocloud.dev/pubsub/kafkapubsub&#34;</span>
<span class="p">)</span>

<span class="c1">// The set of brokers in the Kafka cluster.
</span><span class="c1"></span><span class="nx">addrs</span> <span class="o">:=</span> <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&#34;1.2.3.4:9092&#34;</span><span class="p">}</span>
<span class="c1">// The Kafka client configuration to use.
</span><span class="c1"></span><span class="nx">config</span> <span class="o">:=</span> <span class="nx">kafkapubsub</span><span class="p">.</span><span class="nf">MinimalConfig</span><span class="p">()</span>

<span class="c1">// Construct a *pubsub.Subscription, joining the consumer group &#34;my-group&#34;
</span><span class="c1">// and receiving messages from &#34;my-topic&#34;.
</span><span class="c1"></span><span class="nx">subscription</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">kafkapubsub</span><span class="p">.</span><span class="nf">OpenSubscription</span><span class="p">(</span>
	<span class="nx">addrs</span><span class="p">,</span> <span class="nx">config</span><span class="p">,</span> <span class="s">&#34;my-group&#34;</span><span class="p">,</span> <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&#34;my-topic&#34;</span><span class="p">},</span> <span class="kc">nil</span><span class="p">)</span>
<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
	<span class="k">return</span> <span class="nx">err</span>
<span class="p">}</span>
<span class="k">defer</span> <span class="nx">subscription</span><span class="p">.</span><span class="nf">Shutdown</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span>
</code></pre></div>
<h3 id="mem"> In-Memory<a class="anchor" href="#mem" aria-label="Link to Section">ðŸ”—</a></h3>
<p>The Go CDK includes an in-memory Pub/Sub provider useful for local testing.
The names in <code>mem://</code> URLs are a process-wide namespace, so subscriptions to
the same name will receive messages posted to that topic. For instance, if
you open a topic <code>mem://topicA</code> and open two subscriptions with
<code>mem://topicA</code>, you will have two subscriptions to the same topic.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kn">import</span> <span class="p">(</span>
	<span class="s">&#34;context&#34;</span>

	<span class="s">&#34;gocloud.dev/pubsub&#34;</span>
	<span class="nx">_</span> <span class="s">&#34;gocloud.dev/pubsub/mempubsub&#34;</span>
<span class="p">)</span>

<span class="c1">// Create a topic.
</span><span class="c1"></span><span class="nx">topic</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">pubsub</span><span class="p">.</span><span class="nf">OpenTopic</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span> <span class="s">&#34;mem://topicA&#34;</span><span class="p">)</span>
<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
	<span class="k">return</span> <span class="nx">err</span>
<span class="p">}</span>
<span class="k">defer</span> <span class="nx">topic</span><span class="p">.</span><span class="nf">Shutdown</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span>

<span class="c1">// Create a subscription connected to that topic.
</span><span class="c1"></span><span class="nx">subscription</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">pubsub</span><span class="p">.</span><span class="nf">OpenSubscription</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span> <span class="s">&#34;mem://topicA&#34;</span><span class="p">)</span>
<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
	<span class="k">return</span> <span class="nx">err</span>
<span class="p">}</span>
<span class="k">defer</span> <span class="nx">subscription</span><span class="p">.</span><span class="nf">Shutdown</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span>
</code></pre></div>
<h4 id="mem-ctor"> In-Memory Constructor<a class="anchor" href="#mem-ctor" aria-label="Link to Section">ðŸ”—</a></h4>
<p>To create a subscription to an in-memory Pub/Sub topic, pass the <a href="https://gocloud.dev/howto/pubsub/publish/#mem-ctor">topic you
created</a> into the <a href="https://godoc.org/gocloud.dev/pubsub/mempubsub#NewSubscription"><code>mempubsub.NewSubscription</code> function</a>.
You will also need to pass an acknowledgement deadline: once a message is
received, if it is not acknowledged after the deadline elapses, then it will be
redelivered.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kn">import</span> <span class="p">(</span>
	<span class="s">&#34;context&#34;</span>
	<span class="s">&#34;time&#34;</span>

	<span class="s">&#34;gocloud.dev/pubsub/mempubsub&#34;</span>
<span class="p">)</span>

<span class="c1">// Construct a *pubsub.Topic.
</span><span class="c1"></span><span class="nx">topic</span> <span class="o">:=</span> <span class="nx">mempubsub</span><span class="p">.</span><span class="nf">NewTopic</span><span class="p">()</span>
<span class="k">defer</span> <span class="nx">topic</span><span class="p">.</span><span class="nf">Shutdown</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span>

<span class="c1">// Construct a *pubsub.Subscription for the topic.
</span><span class="c1"></span><span class="nx">subscription</span> <span class="o">:=</span> <span class="nx">mempubsub</span><span class="p">.</span><span class="nf">NewSubscription</span><span class="p">(</span><span class="nx">topic</span><span class="p">,</span> <span class="mi">1</span><span class="o">*</span><span class="nx">time</span><span class="p">.</span><span class="nx">Minute</span> <span class="cm">/* ack deadline */</span><span class="p">)</span>
<span class="k">defer</span> <span class="nx">subscription</span><span class="p">.</span><span class="nf">Shutdown</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span>
</code></pre></div></div>
    </main>
    <nav class="Sidenav">
      <ul class="Sidenav-list">
        <li class="Sidenav-section">
          <a href="/" class="Sidenav-sectionLink">Home</a>
        </li>
        <li class="Sidenav-section">
          <a href="/tutorials/" class="Sidenav-sectionLink">Tutorials</a>
            <ul class="Sidenav-pageList">
              <li class="Sidenav-page">
                <a href="/tutorials/cli-uploader/" class="Sidenav-pageLink">Command-Line Uploader</a>
              </li>
              <li class="Sidenav-page">
                <a href="/tutorials/guestbook/" class="Sidenav-pageLink">Guestbook</a>
              </li>
              <li class="Sidenav-page">
                <a href="/tutorials/order/" class="Sidenav-pageLink">Order Processor</a>
              </li>
            </ul>
        </li>
        <li class="Sidenav-section">
          <a href="/howto/" class="Sidenav-sectionLink">How-To Guides</a>
            <ul class="Sidenav-pageList">
              <li class="Sidenav-page">
                <a href="/howto/blob/" class="Sidenav-pageLink">Blob</a>
              </li>
              <li class="Sidenav-page">
                <a href="/howto/docstore/" class="Sidenav-pageLink">Docstore</a>
              </li>
              <li class="Sidenav-page">
                <a href="/howto/sql/" class="Sidenav-pageLink">MySQL/PostgreSQL</a>
              </li>
              <li class="Sidenav-page">
                <a href="/howto/pubsub/" class="Sidenav-pageLink">Pub/Sub</a>
              </li>
              <li class="Sidenav-page">
                <a href="/howto/runtimevar/" class="Sidenav-pageLink">Runtime Configuration</a>
              </li>
              <li class="Sidenav-page">
                <a href="/howto/secrets/" class="Sidenav-pageLink">Secrets</a>
              </li>
              <li class="Sidenav-page">
                <a href="/howto/server/" class="Sidenav-pageLink">Server</a>
              </li>
            </ul>
        </li>
        <li class="Sidenav-section">
          <a href="/concepts/" class="Sidenav-sectionLink">Concepts</a>
            <ul class="Sidenav-pageList">
              <li class="Sidenav-page">
                <a href="/concepts/structure/" class="Sidenav-pageLink">Structuring Portable Code</a>
              </li>
              <li class="Sidenav-page">
                <a href="/concepts/urls/" class="Sidenav-pageLink">URLs</a>
              </li>
              <li class="Sidenav-page">
                <a href="/concepts/as/" class="Sidenav-pageLink">Using provider-specific APIs</a>
              </li>
            </ul>
        </li>
      </ul>
    </nav>
    <footer class="PageFooter">
      <nav>
        <ul class="FooterLinks">
          <li class="FooterLinks-item"><a href="https://github.com/google/go-cloud/" class="FooterLinks-link">GitHub</a></li>
          <li class="FooterLinks-item"><a href="https://github.com/google/go-cloud/issues" class="FooterLinks-link">Contact Team</a></li>
        </ul>
      </nav>

      <p class="PageFooter-paragraph">
        Copyright Â© 2018â€“2019 The Go Cloud Development Kit Authors.
        All content released under an <a href="https://github.com/google/go-cloud/blob/master/LICENSE" target="_blank" class="PageFooter-link">Apache 2.0 License</a>.
      </p>
      <p class="PageFooter-paragraph"><a href="https://github.com/google/go-cloud/edit/master/internal/website/content/howto/pubsub/subscribe.md" class="PageFooter-link">Improve this page</a> on GitHub.</p>
    </footer>
  </div>
</body>
</html>
